<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Planilha de Entregas</title>
<style>
:root {
  --primary: #0077ff;
  --success: #00b894;
  --danger: #d63031;
  --bg: #f5f9ff;
  --text: #333;
}
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  padding: 15px;
  background: var(--bg);
  color: var(--text);
}
h2 {
  text-align: center;
  margin-bottom: 15px;
}
.metaBox {
  background: white;
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  text-align: center;
  margin-bottom: 15px;
}
.metaBox input {
  width: 120px;
  padding: 6px;
  font-size: 16px;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-left: 10px;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}
th, td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
  font-size: 14px;
}
th {
  background: var(--primary);
  color: white;
}
input[type="number"] {
  width: 50px;
  padding: 4px;
  text-align: center;
  border: 1px solid #ccc;
  border-radius: 6px;
}
input[type="checkbox"] {
  width: 20px;
  height: 20px;
}
.percent {
  font-weight: bold;
  color: var(--primary);
}
.actions {
  text-align: center;
  margin: 15px 0;
}
button {
  padding: 10px 16px;
  border: none;
  border-radius: 8px;
  margin: 4px;
  cursor: pointer;
  font-weight: bold;
  background: var(--primary);
  color: white;
  transition: 0.2s;
}
button:hover {
  background: #005fcc;
}
canvas {
  display: block;
  margin: 20px auto;
  max-width: 350px;
}
@media(max-width:600px){
  th, td { font-size: 12px; }
  input[type="number"] { width: 40px; font-size: 12px; }
}
</style>
</head>
<body>

<h2>üìä Planilha de Entregas</h2>

<div class="metaBox">
  <label>Meta da Semana (R$): 
    <input type="number" id="metaSemana" value="500" onchange="alterarMeta(this.value)">
  </label>
</div>

<table id="planilha">
  <thead>
    <tr>
      <th>Dia</th>
      <th>Fixo (R$)</th>
      <th>Entregas Feitas</th>
      <th>Total do Dia (R$)</th>
      <th>Falta (R$)</th>
      <th>Entregas Restantes</th>
      <th>Dia Ocioso</th>
      <th>% da Meta Di√°ria</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="3"><b>Total Semana</b></td>
      <td id="totalSemana">0</td>
      <td id="faltanteSemana">0</td>
      <td id="restanteSemana">0</td>
      <td>-</td>
      <td id="percentSemana">0%</td>
    </tr>
  </tfoot>
</table>

<canvas id="graficoPizza" width="300" height="300"></canvas>

<div class="actions">
  <button onclick="salvar()">üíæ Salvar</button>
  <button onclick="resetar()">‚ôªÔ∏è Resetar</button>
</div>

<script>
const dias = ["Segunda","Ter√ßa","Quarta","Quinta","Sexta"];
const fixo = 25;
const valorEntrega = 7;

function getData() {
  return JSON.parse(localStorage.getItem("planilhaEntregas")) || [0,0,0,0,0];
}

function getOcioso() {
  return JSON.parse(localStorage.getItem("diasOciosos")) || [false,false,false,false,false];
}

function getMeta() {
  return parseFloat(localStorage.getItem("metaSemana")) || 500;
}

function alterarMeta(val) {
  localStorage.setItem("metaSemana", val);
  renderTabela();
}

function atualizar(idx, val) {
  let data = getData();
  data[idx] = parseInt(val) || 0;
  localStorage.setItem("planilhaEntregas", JSON.stringify(data));
  renderTabela();
}

function marcarOcioso(idx, checked) {
  let ocioso = getOcioso();
  ocioso[idx] = checked;
  localStorage.setItem("diasOciosos", JSON.stringify(ocioso));
  renderTabela();
}

function renderTabela() {
  const tbody = document.querySelector("#planilha tbody");
  tbody.innerHTML = "";

  let data = getData();
  let ocioso = getOcioso();
  let metaSemana = getMeta();

  let totalFixo = fixo * 5; // fixo semanal
  let totalEntregasFeitas = 0;
  let diasAtivos = 0;
  let entregasFeitasPorDia = [];

  ocioso.forEach((d, idx) => {
    if(!d) diasAtivos++;
  });

  // Calcular total de entregas feitas e dias ativos
  data.forEach((e, idx) => {
    if(!ocioso[idx]) totalEntregasFeitas += e;
    entregasFeitasPorDia.push(e);
  });

  // Valor total que ainda falta alcan√ßar na semana (meta - fixo semanal)
  let restanteR$ = Math.max(0, metaSemana - totalFixo - totalEntregasFeitas*valorEntrega);
  // Distribuir restante entre dias ativos
  let distribuidasPorDia = diasAtivos>0 ? Math.ceil(restanteR$/valorEntrega/diasAtivos) : 0;

  let totalSemana = 0;
  let faltanteSemana = 0;
  let restanteSemana = 0;

  data.forEach((e, idx) => {
    let totalDia = fixo + e*valorEntrega;
    let falta = Math.max(0, (metaSemana/5) - totalDia);
    let entregasRestantes = ocioso[idx] ? 0 : distribuidasPorDia;
    let perc = Math.min(100,(totalDia/(metaSemana/5)*100).toFixed(1));

    totalSemana += totalDia;
    faltanteSemana += falta;
    restanteSemana += entregasRestantes;

    tbody.innerHTML += `
      <tr>
        <td>${dias[idx]}</td>
        <td>${fixo.toFixed(2)}</td>
        <td><input type="number" value="${e}" min="0" ${ocioso[idx] ? "disabled" : ""} onchange="atualizar(${idx}, this.value)"></td>
        <td>${totalDia.toFixed(2)}</td>
        <td>${falta.toFixed(2)}</td>
        <td>${entregasRestantes}</td>
        <td><input type="checkbox" ${ocioso[idx] ? "checked" : ""} onchange="marcarOcioso(${idx}, this.checked)"></td>
        <td class="percent">${perc}%</td>
      </tr>
    `;
  });

  document.getElementById("totalSemana").textContent = totalSemana.toFixed(2);
  document.getElementById("faltanteSemana").textContent = Math.max(0, metaSemana - totalSemana).toFixed(2);
  document.getElementById("restanteSemana").textContent = restanteSemana;
  document.getElementById("percentSemana").textContent = Math.min(100,(totalSemana/metaSemana*100).toFixed(1))+"%";

  desenharPizza(totalSemana, metaSemana);
}

function desenharPizza(total, meta) {
  const canvas = document.getElementById("graficoPizza");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const centerX = canvas.width/2;
  const centerY = canvas.height/2;
  const radius = 120;

  const feitoPerc = Math.min(total/meta,1);
  const angFeito = feitoPerc * 2 * Math.PI;

  ctx.beginPath();
  ctx.arc(centerX,centerY,radius,0,2*Math.PI);
  ctx.fillStyle="#eee";
  ctx.fill();

  ctx.beginPath();
  ctx.moveTo(centerX,centerY);
  ctx.arc(centerX,centerY,radius,-Math.PI/2,angFeito-Math.PI/2);
  ctx.closePath();
  ctx.fillStyle="#00b894";
  ctx.fill();

  ctx.fillStyle="#333";
  ctx.font="bold 18px Arial";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText(((feitoPerc*100).toFixed(1))+"%",centerX,centerY);
}

function salvar(){ alert("‚úÖ Dados salvos!"); }
function resetar(){
  if(confirm("Resetar tudo?")){
    localStorage.removeItem("planilhaEntregas");
    localStorage.removeItem("diasOciosos");
    localStorage.removeItem("metaSemana");
    document.getElementById("metaSemana").value=500;
    renderTabela();
  }
}

document.getElementById("metaSemana").value = getMeta();
renderTabela();
</script>

</body>
</html>
